
     jur2_2011.txt
     январь 2011 г.

     p:\POSTANOV\ПЕНСФОНД\ПЕРЕРАСЧЕТ\2011


         I.  РАСЧЕТ НАЛОГА НА ФОНД ОПЛАТЫ ТРУДА 
             С ЮРИДИЧЕСКОГО ЛИЦА ЗА РАСЧЕТНЫЙ МЕСЯЦ. 
             ---------------------------------------

    Основание : введение в действие с 01.01.2011 г. постановления правления ПФУ 
    "Порядок формування та подання страхувальниками звiту щодо сум нарахованого 
    Єдиного внеску на загальнообов"язкове державне соцiальне страхування "
    от 08.10.2010 г. N 22-2.

    За основу возьмем программу RRPAY800.


   Используем существующую таблицу RECALCJUR - "расчет и перерасчет удержаний с юр. лица".

   Раньше использовали коды удержаний :

     800  -  начисление на фонд оплаты труда с работодателя
     802  -  начисление на фонд оплаты труда с работодателя
             по зарплате чернобыльцев (до 2010г.)
     801  -  перерасчет начисления на фонд оплаты труда с работодателя

     Сделаем :

     800  -  налог с работодателя на заработную плату
     801  -  перерасчет налога с работодателя на заработную плату
     804  -  налог с работодателя на вознаграждение по ГПД
     805  -  перерасчет налога с работодателя на вознаграждение по ГПД 
     806  -  налог с работодателя на больничные за счет предприятия и на
             больничные (произв. травмы)
     807  -  перерасчет налога с работодателя на больничные за счет предприятия и
             на больничные (произв. травмы)
     808  -  налог с работодателя на больничные за счет ФСС
     809  -  перерасчет налога с работодателя на больничные за счет ФСС
 

  1.  Панель для расчета:

   ╒═══════════════════════════════╤════════════════════════════╕
   │  ▐▐▐▐ -  Год расчета          │ 00:00:00 - Время расчета   │
   │    ▐▐ -  Месяц расчета        │          - ведомостей      │
   │ ▐▐▐▐▐ -  Таб. номер           │                            │
   │   [*] -  режим контроля       │                            │
   ├───────────────────────────────┴────────────────────────────┤
   │ ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░   ░░% │
   ╘════════════════════════════════════════════════════════════╛

     Год, за который производится расчет, автоматически сделать
     равным году системной даты.
     Предоставить возможность корректировки.

     Месяц, за который производится расчет, автоматически сделать
     равным году системной даты.
     Предоставить возможность корректировки.

     Таб.номер - табельный номер работника или 0 для расчета по всем табельным
                 номерам.

     Обозначим информацию, вводимую в панели:
     Год расчета         - YEARR
     Месяц расчета       - MONTHR
     табельный номер     - EMP  ( nvl(EMP,0) = 0 - по всем таб.номерам )

     Если расчет с записью в базу, то перед расчетом удалить записи из 
     таблицы RECALCJUR по условиям:
        YEAR  = YEARR  and
        MONTH = MONTHR and
       (  EMP# = EMP or nvl(EMP,0)=0 )  


  2.  Определим все необходимые для расчета переменные.

   -  Определим дату начала месяца, года, за который проводится расчет.
      Обозначим ее datemin.
      datemin = 01/MONTHR/YEARR

   -  SumMax - верхняя граница для расчета суммы удержаний.
      Выбрать значение NVAL из справочника SYSINDEX с IND# = 541
      при условии, что datemin >= максимально возможного значения поля INDATE.
        SumMax = SYSINDEX(541,datemin).

   -  KFzpl - коэффициент для удержания взноса с зарплаты не инвалидов.
      С 01.01.2011  значение = 0.3866
      Выбрать значение NVAL из справочника SYSINDEX с IND# = 401.
      при условии, что datemin >= максимально возможного значения поля INDATE.
       KFzpl = SYSINDEX(401,datemin).

   -  KFzpli - коэффициент для удержания взноса с зарплаты инвалидов.
      С 01.01.2011  значение = 0.0841
      Выбрать значение NVAL из справочника SYSINDEX с IND# = 405.
      при условии, что datemin >= максимально возможного значения поля INDATE.
       KFzpli = SYSINDEX(405,datemin).

   -  KFgpd - коэффициент для удержания взноса с вознаграждения за работы по ГПД.
      С 01.01.2011  значение = 0.347
      Выбрать значение NVAL из справочника SYSINDEX с IND# = 434.
      при условии, что datemin >= максимально возможного значения поля INDATE.
       KFgpd = SYSINDEX(434,datemin).

   -  KFbol - коэффициент для удержания взноса с больничных за счет предприятия 
      и с больничных (произв. травмы). 
      С 01.01.2011  значение = 0.332
      Выбрать значение NVAL из справочника SYSINDEX с IND# = 430.
      при условии, что datemin >= максимально возможного значения поля INDATE.
       KFbol = SYSINDEX(430,datemin).

   -  KFblfss - коэффициент для удержания взноса с больничных за счет ФСС.
      С 01.01.2011 значение = 0.332
      Выбрать значение NVAL из справочника SYSINDEX с IND# = 430.
      при условии, что datemin >= максимально возможного значения поля INDATE.
       KFblfss = SYSINDEX(430,datemin).

   -  RUzpl  - расчетное удержание по зарплате.
      Начальное значение = 0.

   -  RUgpd  - расчетное удержание по вознаграждению по ГПД.
      Начальное значение = 0.

   -  RUbol  - расчетное удержание по больничным за счет предпр. и с больн.(произв.травмы).
      Начальное значение = 0.

   -  RUblfss - расчетное удержание по больничным за счет ФСС.
      Начальное значение = 0.


  3.  Основной запрос :
      SELECT EMP#, YEAR, MONTH, SHOP, EXPEND#, SUM2, SUM3, SUM4, SUM5, FLAGINV
      FROM PAYRECJUR
      WHERE
      EMP# = EMP and
      YEAR = YEARR and
      MONTH = MONTHR 


  4.  Для каждого табельного номера EMP по каждому (EXPEND#, SHOP)
      рассчитаем :

      Для  FLAGINV != 1  RUzpl = round2(SUM2 * KFzpl)
      Для  FLAGINV  = 1  RUzpl = round2(SUM2 * KFzpli)

      RUbol = round2(SUM3 * KFbol)

      RUblfss = round2(SUM4 * KFblfss)

      RUgpd = round2(SUM5 * KFgpd)


  5.  Запишем результат расчета в таблицу RECALCJUR (максимум 4 типа записи) :

      - если ( RUzpl   !=0 или SUM22 !=0 ), то PAY# = 800 , SUM = RUzpl 
      - если ( RUbol   !=0 или SUM33 !=0 ), то PAY# = 806 , SUM = RUbol
      - если ( RUblfss !=0 или SUM44 !=0 ), то PAY# = 808 , SUM = RUblfss
      - если ( RUgpd   !=0 или SUM55 !=0 ), то PAY# = 804 , SUM = RUgpd

      Остальные поля записи :

      EMP#    = EMP
      YEAR    = YEARR
      MONTH   = MONTHR
      FACTMON = YEARR * 100 + MONTHR
      EXPEND# = PAYRECJUR.EXPEND#
      FLAGINV = PAYRECJUR.FLAGINV
      DBUSER  =  'DD/MM/YY HH:SS USERNAME'
      RSHOP   = PAYRECJUR.SHOP


  Расчет добавить в оболочку pay2.exe
  в пункт "Расчет"
  в пункт "Перерасчет удержаний в бюджетные фонды"
  в подпункт "Расчет удержаний с юр.лица в ПФ"




         II. ПЕРЕРАСЧЕТ НАЛОГА НА ФОНД ОПЛАТЫ ТРУДА 
             С ЮРИДИЧЕСКОГО ЛИЦА ЗА ПЕРИОД. 
             ---------------------------------------

    За основу возьмем программу RRPAY801.

  1.  Панель для перерасчета:


   ╒═══════════════════════════════╤════════════════════════════╕
   │  ▐▐▐▐ -  Год перерасчета      │ 00:00:00 - Время расчета   │
   │    ▐▐ -  Месяц перерасчета    │          - ведомостей      │
   │  ▐▐▐▐ -  Год,за кот.перерасч. │                            │
   │    ▐▐ -  Месяц, за кот.перер. │                            │
   │ ▐▐▐▐▐ -  Таб. номер           │                            │
   │   [*] -  режим контроля       │                            │
   ├───────────────────────────────┴────────────────────────────┤
   │ ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░   ░░% │
   ╘════════════════════════════════════════════════════════════╛

     Год перерасчета автоматически сделать равным году системной даты.
     Предоставить возможность корректировки.

     Год, за который производится перерасчет, автоматически сделать
     равным году системной даты.
     Предоставить возможность корректировки.

     Месяц перерасчета автоматически сделать равным месяцу системной даты.
     Предоставить возможность корректировки.

     Месяц, за который производится перерасчет, автоматически сделать
     равным месяцу системной даты.
     Предоставить возможность корректировки.
     Месяц, за который производится перерасчет - последний месяц периода
     перерасчета.

     Таб.номер - табельный номер работника или 0 для перерасчета по всем табельным
                 номерам.

     Обозначим информацию, вводимую в панели:
     Год перерасчета               - YEARR
     Год, за который перерасчет    - YEARREC
     Месяц перерасчета             - MONTHR
     Месяц, за который перерасчет  - MONTHREC
     Табельный номер               - EMP

     Перед перерасчетом удалить ( в случае режима с записью в базу)  записи 
     из таблицы RECALCJUR по условиям:

       YEAR    = YEARR  and 
       MONTH   = MONTHR  and
       (  EMP# = EMP or nvl(EMP,0)=0 ) and 
        PAY# in ( 801,805,807,809 )


  2.  Основной запрос :

      SELECT EMP#, YEAR, MONTH, SHOP, EXPEND#, SUM2, SUM3, SUM4, SUM5 , FLAGINV
      FROM PAYRECJUR
      WHERE
      ( EMP# = EMP or EMP = nvl(EMP,0) ) and
      YEAR = YEARREC and 
      MONTH between 1 and MONTHREC


  3.  Определим все необходимые для перерасчета переменные.

     Обозначим MONTHI - месяц, за который производится перерасчет.
        1 <= MONTHI <= MONTHREC
     Определим дату начала месяца, года, за который проводится перерасчет.
     Обозначим ее datemin.
   -  datemin = 01/MONTHI/YEARR

   -  Обозначим SumMax - верхняя граница для расчета суммы удержаний в ПФ .
      Выбрать значение NVAL из справочника SYSINDEX с IND = 541
      при условии, что datemin >= максимально возможного значения поля INDATE.
      SumMax = SYSINDEX(541,datemin).
      С 01.01.2011  SumMax = 14115 грн.

   -  KFzpl - коэффициент для удержания взноса с зарплаты не инвалидов.
      С 01.01.2011  значение = 0.3866
      Выбрать значение NVAL из справочника SYSINDEX с IND# = 401.
      при условии, что datemin >= максимально возможного значения поля INDATE.
       KFzpl = SYSINDEX(401,datemin).

   -  KFzpli - коэффициент для удержания взноса с зарплаты инвалидов.
      С 01.01.2011  значение = 0.0841
      Выбрать значение NVAL из справочника SYSINDEX с IND# = 405.
      при условии, что datemin >= максимально возможного значения поля INDATE.
       KFzpli = SYSINDEX(405,datemin).

   -  KFgpd - коэффициент для удержания взноса с вознаграждения за работы по ГПД.
      С 01.01.2011  значение = 0.347
      Выбрать значение NVAL из справочника SYSINDEX с IND# = 434.
      при условии, что datemin >= максимально возможного значения поля INDATE.
       KFgpd = SYSINDEX(434,datemin).

   -  KFbol - коэффициент для удержания взноса с больничных за счет предприятия 
      и с больничных (произв. травмы). 
      С 01.01.2011  значение = 0.332
      Выбрать значение NVAL из справочника SYSINDEX с IND# = 430.
      при условии, что datemin >= максимально возможного значения поля INDATE.
       KFbol = SYSINDEX(430,datemin).

   -  KFblfss - коэффициент для удержания взноса с больничных за счет ФСС.
      С 01.01.2011 значение = 0.332
      Выбрать значение NVAL из справочника SYSINDEX с IND# = 430.
      при условии, что datemin >= максимально возможного значения поля INDATE.
       KFblfss = SYSINDEX(430,datemin).


     Обозначим EMPI - обрабатываемый табельный номер.
     Для каждого (EXPEND#,SHOP) определим :

   -  RUzpl  - расчетное удержание с зарплаты.
      Начальное значение = 0.
   -  UFzpl  - фактическое удержание.
      Начальное значение = 0.
   -  RAZzpl - разность между расчетным и фактическим удержанием.
      Начальное значение = 0.

   -  RUgpd  - расчетное удержание с вознаграждения по ГПД.
      Начальное значение = 0.
   -  UFgpd  - фактическое удержание.
      Начальное значение = 0.
   -  RAZgpd - разность между расчетным и фактическим удержанием.
      Начальное значение = 0.

   -  RUbol  - расчетное удержание с больничных за счет предпр. и с больн.(произв.травмы).
      Начальное значение = 0.
   -  UFbol  - фактическое удержание.
      Начальное значение = 0.
   -  RAZbol - разность между расчетным и фактическим удержанием.
      Начальное значение = 0.

   -  RUblfss - расчетное удержание с больничных за счет ФСС.
      Начальное значение = 0.
   -  UFblfss  - фактическое удержание.
      Начальное значение = 0.
      RAZblfss - разность между расчетным и фактическим удержанием.
      Начальное значение = 0.

  4.
     Вычислим фактические и рассчетные суммы удержаний за MONTHI , а также
     разницу между рассчетными и фактическими удержаниями.

     Обозначим :
     SHP - обрабатываемый SHOP
     EXP - обрабатываемый EXPEND#

  4.1. SELECT SUM(SUM) into UFzpl
       FROM RECALCJUR
       WHERE 
       EMP# = EMP and
       FACTMON = YEARREC * 100 + MONTHI and
       SHOP = SHP and
       EXPEND# = EXP and
       PAY# in (800,801,802)

     Если nvl(FLAGINV,0) =0 , то RUzpl = round2(SUM2 * KFzpl)    /* не инвалид */
     Иначе                       RUzpl = round2(SUM2 * KFzpli)   /* инвалид */

       RAZzpl = RUzpl - UFzpl

  4.2. SELECT SUM(SUM) into UFbol
       FROM RECALCJUR
       WHERE 
       EMP# = EMP and
       FACTMON = YEARREC * 100 + MONTHI and
       SHOP = SHP and
       EXPEND# = EXP and
       PAY# in (806,807)

       RUbol = round2(SUM3 * KFbol)   

       RAZbol = RUbol - UFbol

  4.3. SELECT SUM(SUM) into UFblfss
       FROM RECALCJUR
       WHERE 
       EMP# = EMP and
       FACTMON = YEARREC * 100 + MONTHI and
       SHOP = SHP and
       EXPEND# = EXP and
       PAY# in (808,809)

       RUblfss = round2(SUM4 * KFblfss)   

       RAZblfss = RUblfss - UFblfss

  4.4. SELECT SUM(SUM) into UFgpd
       FROM RECALCJUR
       WHERE 
       EMP# = EMP and
       FACTMON = YEARREC * 100 + MONTHI and
       SHOP = SHP and
       EXPEND# = EXP and
       PAY# in (804,805)

       RUgpd = round2(SUM5 * KFgpd)   

       RAZgpd = RUgpd - UFgpd

  5. Если режим "с записью в базу" , то сформируем записи в таблице RECALCJUR 
     для каждого вида перерасчета (RAZzpl,RAZbol,RAZblfss,RAZgpd).

   Если RAZzpl   != 0 , то  SUM = RAZzpl ,   PAY# = 801.  
   Если RAZbol   != 0 , то  SUM = RAZbol ,   PAY# = 807.
   Если RAZblfss != 0 , то  SUM = RAZblfss , PAY# = 809.
   Если RAZgpd   != 0 , то  SUM = RAZgpd ,   PAY# = 805.

   Заполнение остальных полей записи :
      EMP#    = EMP
      YEAR    = YEARR
      MONTH   = MONTHR
      FACTMON = YEARREC * 100 + MONTHI
      EXPEND# = PAYRECJUR.EXPEND#
      FLAGINV = PAYRECJUR.FLAGINV
      DBUSER  =  'DD/MM/YY HH:SS USERNAME'
      RSHOP   = PAYRECJUR.SHOP


     Результат перерасчета выдать в файлы :

      rep801.lst  - по не-секретчикам
      rep801s.lst - по секретчикам

   Перерасчет за  YEARREC  год 
                  -------

    Напечатаем расшифровку типов начислений :

 -------------------------
    Тип начисления :
    1 - зарплата,отпускные 
    2 - больничные листы за счет предприятия, больничные листы (произв.травмы)
    3 - больничные листы за счет ФСС
    4 - вознаграждение за работы по ГПД

 -------------------------
     5.1.                         
     По каждому таб. номеру за все месяцы перерасчета печатаем:

     таб. номер = EMP    дата увольнения = DSCHDATE1

     Распечатать данные для проверки перерасчета :

     5.2.
      -  тип начисления = 1
      -  месяц = MONTHI
      -  шифр производственных затрат = EXPEND#
      -  флаг инвалидности = FLAGINV
      -  цех = RSHOP
      -  облаг. сумма = SUM2
      -  превышение   = SUM22
      -  расчетное удержание =  RUzpl
      -  фактическое удержание = UFzpl
      -  перерасчет удержания  = RAZzpl

       Если ( SUM3=0 and SUM33=0 and RUbol=0 and UFbol=0 and RAZbol=0 ), то переход на 5.3. 

       Иначе напечатать :

      -  тип начисления = 2
      -  месяц = MONTHI
      -  шифр производственных затрат = EXPEND#
      -  флаг инвалидности = FLAGINV
      -  цех = RSHOP
      -  облаг. сумма = SUM3
      -  превышение   = SUM33
      -  расчетное удержание =  RUbol
      -  фактическое удержание = UFbol
      -  перерасчет удержания  = RAZbol

     5.3.
       Если ( SUM4=0 and SUM44=0 and RUblfss=0 and UFblfss=0 and RAZblfss=0 ), то переход на 5.4. 

       Иначе напечатать :

      -  тип начисления = 3
      -  месяц = MONTHI
      -  шифр производственных затрат = EXPEND#
      -  флаг инвалидности = FLAGINV
      -  цех = RSHOP
      -  облаг. сумма = SUM4
      -  превышение   = SUM44
      -  расчетное удержание =  RUblfss
      -  фактическое удержание = UFblfss
      -  перерасчет удержания  = RAZblfss

      5.4.
       Если ( SUM5=0 and SUM55=0 and RUgpd=0 and UFgpd=0 and RAZgpd=0 ), то переход на 5.1. 

       Иначе напечатать :

      -  тип начисления = 4
      -  месяц = MONTHI
      -  шифр производственных затрат = EXPEND#
      -  флаг инвалидности = FLAGINV
      -  цех = RSHOP
      -  облаг. сумма = SUM5
      -  превышение   = SUM55
      -  расчетное удержание =  RUgpd
      -  фактическое удержание = UFgpd
      -  перерасчет удержания  = RAZgpd

     Вид строки :

     М-ц Тип  ШПЗ     Инв  Облаг.сумма  Превыш.  Уд.Расч  Уд.Факт  Уд.Перер
     ======================================================================


   Пример печати :
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 


 Перерасчет за 2010 год 

    Тип начисления :
    1 - зарплата,отпускные 
    2 - больничные листы за счет предприятия, больничные листы (произв.травмы)
    3 - больничные листы за счет ФСС
    4 - вознаграждение за работы по ГПД



  Таб.номер 96421
  М-ц Тип   ШПЗ      Цех  Инв     Облаг.сумма    Превыш.    Уд.Расч.   Уд.Факт.  Уд.Перер.
  ========================================================================================
   1   1 949925850     30  0          1342.53     0.00       445.72    445.72     0.00
   2   1 230125100     30  0           -29.19     0.00        -9.69     -9.69     0.00
   2   2 685028400     30  0           866.71     0.00       287.75    287.75     0.00


  Таб.номер 96422
  М-ц Тип   ШПЗ      Цех  Инв     Облаг.сумма    Превыш.    Уд.Расч.   Уд.Факт.  Уд.Перер.
  ========================================================================================
   1   2 949925850     30  0          1379.01     0.00       457.83    457.83     0.00
   2   3 230125100     30  0           -87.56     0.00       -29.07    -29.07     0.00


   Перерасчет добавить в оболочку pay2.exe
    в пункт "Расчет"
    в пункт "Перерасчет удержаний в бюджетные фонды"
    в подпункт "Перерасчет удержаний в ПФ с юр.лиц за период "




